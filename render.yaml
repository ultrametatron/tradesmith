services:
  # 1) Persistent intraday worker
  - type: worker
    name: tradesmith-worker
    plan: standard
    runtime: docker
    disk:
      name: tradesmith-data
      mountPath: /data
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: FMP_API_KEY
        sync: false
    startCommand: python worker.py

  # 2) Daily master‐prices refresh (Mon–Fri @ 11:00 UTC / 07:00 ET)
  - type: cron
    name: tradesmith-daily-metrics
    schedule: "0 11 * * 1-5"
    command: python update_master_prices.py
    envVars:
      - key: FMP_API_KEY
        sync: false

  # 3) Daily email delivery/report (Tue–Sat @ 00:00 UTC)
  - type: cron
    name: tradesmith-daily-report
    schedule: "0 0 * * 2-6"
    command: python run_daily_delivery.py
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: SMTP_SERVER
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false
      - key: DELIVERY_EMAIL
        sync: false

  # 4) Weekly CIO memo (Sat @ 00:00 UTC)
  - type: cron
    name: tradesmith-weekly-report
    schedule: "0 0 * * SAT"
    command: python run_weekly_report.py
    envVars:
      - key: OPENAI_API_KEY
        sync: false
